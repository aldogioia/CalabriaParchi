<form [formGroup]="interestForm" (ngSubmit)="submit()">
  <h3>Aggiungi nuovi Interessi</h3>

  <div class="input-group" [class.error]="isInvalid('parkId')">
    <label for="park">Parco</label>
    <select name="park" [class.color]="interestForm.value.parkId === ''" formControlName="parkId" required>
      <option value="" disabled selected>Seleziona un Parco</option>
      @for (park of parks; track park.id) {
        <option [value]="park.id">{{ park.name }}</option>
      }
    </select>
    @if (isInvalid('parkId')) {
      <span class="error-message">{{ getErrorMessage('parkId') }}</span>
    }
  </div>

  <div class="input-group" [class.error]="isInvalid('name')">
    <label for="name">Nome</label>
    <input name="name" type="text" placeholder="Nome" formControlName="name" required>
    @if (isInvalid('name')) {
      <span class="error-message">{{ getErrorMessage('name') }}</span>
    }
  </div>

  <div class="input-group" [class.error]="isInvalid('englishName')">
    <label for="en_name">Nome inglese</label>
    <input name="en_name" type="text" placeholder="Nome in inglese" formControlName="englishName" required>
    @if (isInvalid('englishName')) {
      <span class="error-message">{{ getErrorMessage('englishName') }}</span>
    }
  </div>

  <div class="input-group" [class.error]="isInvalid('website')">
    <label for="url">Url</label>
    <input name="url" type="url" placeholder="Url" formControlName="website">
    @if (isInvalid('website')) {
      <span class="error-message">{{ getErrorMessage('website') }}</span>
    }
  </div>

  <div class="input-group" [class.error]="isInvalid('phoneNumber')">
    <label for="tel">Numero di telefono</label>
    <input name="tel" type="tel" placeholder="Numero di telefono" formControlName="phoneNumber">
    @if (isInvalid('phoneNumber')) {
      <span class="error-message">{{ getErrorMessage('phoneNumber') }}</span>
    }
  </div>

  <div class="input-group" [class.error]="isInvalid('description')">
    <label>Descrizione</label>
    <textarea formControlName="description" maxlength="500" placeholder="Inserisci una descrizione"></textarea>
    @if (isInvalid('description')) {
      <span class="error-message">{{ getErrorMessage('description') }}</span>
    }
  </div>

  <div class="input-group" [class.error]="isInvalid('englishDescription')">
    <label>Descrizione Inglese</label>
    <textarea formControlName="englishDescription"  maxlength="500" placeholder="Inserisci una descrizione"></textarea>
    @if (isInvalid('englishDescription')) {
      <span class="error-message">{{ getErrorMessage('englishDescription') }}</span>
    }
  </div>

  <div class="input-group">
    <label for="img">Foto</label>
    <div class="file-wrapper">
      <input #fileInputImage id="img" name="img" type="file" accept="image/jpeg,image/png" (change)="onFileSelected($event, FileType.IMAGE)" required>
    </div>
  </div>

  <div class="input-group">
    <label for="pdf">Pdf</label>
    <div class="file-wrapper">
      <input #fileInputPdf id="pdf" name="pdf" type="file" accept="application/pdf" (change)="onFileSelected($event, FileType.PDF)" required>
    </div>
  </div>

  <div class="input-group">
    <label for="tags">Tag</label>
    <div class="tags" formArrayName="tags">
      @for (tag of tags; track tag.id; let i = $index) {
        <span
          class="tag"
          [class.selected]="tagsArray.value?.[i]"
          (click)="toggleChip('tags', i)">
          {{ tag.name }}
        </span>
      }
    </div>
  </div>

  <div class="input-group">
    <label for="categories">Categorie</label>
    <div class="tags" formArrayName="categories">
      @for (category of categories; track category.id; let i = $index) {
        <span
          class="tag"
          [class.selected]="categoriesArray.value?.[i]"
          (click)="toggleChip('categories', i)">
          {{ category.name }}
        </span>
      }
    </div>
  </div>

  <div class="input-group radio-group">
    <div class="radio-button" [class.selected]="typeSelected === InterestType.ACTIVITY" (click)="interestForm.patchValue({interestType: InterestType.ACTIVITY})">
      <span>Attività</span>
      <p class="little-text">Indica un'esperienza da vivere: escursioni, sport, tour guidati o eventi.</p>
    </div>
    <div class="radio-button" [class.selected]="typeSelected === InterestType.LOCATION" (click)="interestForm.patchValue({interestType: InterestType.LOCATION})">
      <span>Località</span>
      <p class="little-text">Indica un luogo fisico: borghi, spiagge, monumenti o punti panoramici.</p>
    </div>
    <div class="radio-button" [class.selected]="typeSelected === InterestType.FOOD_AND_WINE" (click)="interestForm.patchValue({interestType: InterestType.FOOD_AND_WINE})">
      <span>Enogastronomia</span>
      <p class="little-text">Indica sapori e tradizioni: ristoranti, cantine, sagre o prodotti tipici.</p>
    </div>
  </div>

  <button
    class="primary-button"
    type="submit"
    [disabled]="interestForm.invalid || loading">
    {{ interestToModify ? "Modifica" : "Aggiungi" }}
  </button>

  <div class="row">
    <button class="tertiary-button" type="reset" (click)="resetForm()">
      Annulla
    </button>

    @if (interestToModify) {
      <button
        class="tertiary-button error"
        type="reset"
        [disabled]="loading"
        (click)="deleteInterest()">
        Elimina
      </button>
    }
  </div>
</form>

<section>
  <div class="sub-section">
    <h4>Anteprima</h4>
    <div class="box">
      <app-park-item-component [interestDto]="interestPreview" [showWishlistButton]="false"></app-park-item-component>
    </div>
  </div>
  <form [formGroup]="parkForm" class="sub-section">
    <h4>Interessi già presenti</h4>

    <div class="input-group">
      <select [class.color]="parkForm.value.parkId === ''" formControlName="parkId">
        <option value="">Seleziona un Parco</option>
        @for (park of parks; track park.id) {
          <option [value]="park.id">{{ park.name }}</option>
        }
      </select>
    </div>

    @if (parkForm.get('parkId')?.value === '') {
      <p>Seleziona un Parco per visualizzare gli interessi associati.</p>
    } @else if (interests.length) {
      <div class="box">
        @for (interest of interests; track interest.id) {
          <div class="wrapper">
            <button class="secondary-button" (click)="selectInterest(interest)">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M20.95,3.05 C22.017,4.117 22.017,5.847 20.95,6.914 L14.314,13.55 L14.234,13.631 C13.265,14.599 12.673,15.191 11.945,15.598 C11.538,15.825 10.922,16.024 10.291,16.199 C9.642,16.38 8.895,16.558 8.182,16.728 L8.174,16.73 C7.92,16.79 7.654,16.715 7.47,16.53 C7.286,16.346 7.21,16.08 7.27,15.826 L7.272,15.818 C7.442,15.105 7.62,14.358 7.801,13.709 C7.976,13.078 8.175,12.462 8.402,12.055 C8.809,11.327 9.401,10.735 10.369,9.766 L10.37,9.766 L10.45,9.686 L17.086,3.05 C18.153,1.983 19.883,1.983 20.95,3.05 Z M12,2.25 C12.414,2.25 12.75,2.586 12.75,3 C12.75,3.414 12.414,3.75 12,3.75 C9.857,3.75 8.326,3.752 7.162,3.908 C6.02,4.062 5.345,4.352 4.848,4.848 C4.352,5.345 4.062,6.02 3.908,7.162 C3.752,8.326 3.75,9.857 3.75,12 C3.75,14.142 3.752,15.674 3.908,16.838 C4.062,17.98 4.352,18.655 4.848,19.152 C5.345,19.648 6.02,19.938 7.162,20.092 C8.326,20.248 9.857,20.25 12,20.25 C14.142,20.25 15.674,20.248 16.838,20.092 C17.98,19.938 18.655,19.648 19.152,19.152 C19.648,18.655 19.938,17.98 20.092,16.838 C20.248,15.674 20.25,14.142 20.25,12 C20.25,11.586 20.586,11.25 21,11.25 C21.414,11.25 21.75,11.586 21.75,12 L21.75,12.057 C21.75,14.13 21.75,15.762 21.579,17.038 C21.403,18.346 21.034,19.391 20.212,20.212 C19.391,21.034 18.346,21.403 17.038,21.579 C15.762,21.75 14.13,21.75 12.057,21.75 L11.943,21.75 C9.87,21.75 8.238,21.75 6.962,21.579 C5.654,21.403 4.609,21.034 3.788,20.212 C2.966,19.391 2.597,18.346 2.421,17.038 C2.25,15.762 2.25,14.13 2.25,12.057 L2.25,11.943 C2.25,9.87 2.25,8.238 2.421,6.962 C2.597,5.654 2.966,4.609 3.788,3.788 C4.609,2.966 5.654,2.597 6.962,2.421 C8.238,2.25 9.87,2.25 11.943,2.25 Z M16.214,6.043 L11.511,10.747 C10.436,11.821 10.005,12.262 9.711,12.787 C9.582,13.017 9.424,13.471 9.246,14.111 C9.17,14.385 9.094,14.678 9.018,14.982 C9.322,14.906 9.615,14.83 9.889,14.754 C10.529,14.576 10.983,14.418 11.213,14.289 C11.738,13.995 12.179,13.564 13.253,12.489 L17.957,7.786 Z M18.146,4.111 L17.275,4.982 L19.018,6.725 L19.889,5.854 C20.37,5.373 20.37,4.592 19.889,4.111 C19.408,3.63 18.628,3.63 18.146,4.111 Z" />
              </svg>
            </button>
            <app-park-item-component [interestDto]="interest" [showWishlistButton]="false"></app-park-item-component>
          </div>
        }
      </div>
    } @else {
      <p>Nessun Interesse presente per il parco selezionato.</p>
    }
  </form>
</section>

